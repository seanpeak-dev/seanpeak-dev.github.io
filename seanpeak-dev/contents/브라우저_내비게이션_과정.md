---
date: '2021-11-02'
title: '브라우저 내비게이션 과정'
categories: ['브라우저']
summary: '브라우저 프로세스의 UI 스레드, 네트워크 스레드와 렌더러 프로세스를 통한 네비게이션 과정'
---
## 브라우저 프로세스
- 브라우저 프로세스의 UI 스레드는 브라우저의 버튼과 입력란을 그린다. 주소 표시줄에 URL을 입력하면 UI 스레드가 입력을 처리한다.
- 네트워크 스레드는 인터넷에서 데이터를 가져오기 위해 네트워크 스택을 다룬다.
- 스토리지 스레드는 파일에 대한 접근을 제어한다.

## 네비게이션
- 입력 처리 : 검색어인지 URL인지에 따라 처리 방식이 달라진다.
- UI 스레드가 네트워크 스레드를 호출하고, 로딩 스피너를 표시한다.
- 네트워크 스레드는 요청에 대한 DNS Lookup 및 TLS(Transport Layer Security) 연결 설정 등 적절한 프로토콜을 거쳐 요청을 처리한다.
- 응답 본문인 페이로드가 들어오기 시작하면 응답 헤더의 Content-Type 헤더가 잘못된 정보일 수도 있기 때문에 스트림의 처음 몇 바이트를 확인하는 MIME 스니핑을 통해 데이터의 실제 형식을 알아낸다.
- 응답이 HTML 파일이라면 데이터를 렌더러 프로세스에 전달한다. 렌더러 프로세스가 다룰 수 있는 데이터 형식인지 아닌지를 구분하여 처리한다.
- Safe Browsing 검사를 통해 악성 사이트인지 검사하고, CORB(Cross-Origin Read Blocking) 기능으로 서로 다른 사이트(cross-site)의 민감한 데이터가 렌더러 프로세스에서 실행되지 않게 검사한다.
- 네트워크 스레드는 UI 스레드에 데이터가 준비되었음을 알린다. 브라우저 프로세스에서 렌더러 프로세스로 IPC 메시지를 전송한다. 또한 렌더러 프로세스가 HTML 데이터를 계속 수신할 수 있도록 브라우저 프로세스는 데이터 스트림을 전달한다.
- 렌더러 프로세스에서 내비게이션이 실행되었다는 것을 브라우저 프로세스가 확인하고 나면 내비게이션이 완료되고 문서 로딩 단계가 시작된다.
- 렌더러 프로세스가 렌더링을 '끝내면' 브라우저 프로세스로 IPC 메시지를 보낸다(이 시점은 페이지의 모든 프레임에서 onload 이벤트의 실행까지 끝낸 이후이다).
- 사용자가 주소 표시줄에 다른 URL을 다시 입력하면 어떻게 될까? 브라우저 프로세스는 동일한 단계를 거쳐 다른 사이트로 이동을 처리한다. 하지만 그전에 현재 렌더링된 사이트에서 beforeunload 이벤트를 확인해야 한다.
- [overview_of_page_lifecycle_states_and_events](https://developers.google.com/web/updates/2018/07/page-lifecycle-api#overview_of_page_lifecycle_states_and_events)

### 서비스 워커
- 서비스 워커는 애플리케이션의 코드에 네트워크 프락시를 작성할 수 있는 수단이다.
- 서비스 워커를 통해 웹 개발자는 무엇을 로컬 캐시에 저장할지, 언제 네트워크에서 새 데이터를 가져올지 제어할 수 있다.
- 서비스 워커가 렌더러 프로세스에서 실행되는 JavaScript 코드라는 점이다.
- 서비스 워커가 캐시에서 페이지를 로드하도록 설정되었다면 네트워크에서 데이터를 가져오도록 요청할 필요가 없다.

